<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GIF Slideshow</title>
<style>
  /* Reset */
  html, body { height: 100%; margin: 0; background: #000; }
  body { overflow: hidden; }

  :root{
    --color-text: #fff;
    --color-bg: #000;
    --color-link: #f9d77e;
    --color-link-hover: #fff;
    --color-info: #efc453;
    --glitch-width: 100vw;
    --glitch-height: 100vh;
    --gap-horizontal: 10px;
    --gap-vertical: 5px;
    --time-anim: 4s;
    --delay-anim: 2s;
    --blend-mode-1: none;
    --blend-mode-2: none;
    --blend-mode-3: none;
    --blend-mode-4: none;
    --blend-mode-5: overlay;
    --blend-color-1: transparent;
    --blend-color-2: transparent;
    --blend-color-3: transparent;
    --blend-color-4: transparent;
    --blend-color-5: #af4949;
  }

  /* Container holding two layers for crossfade */
  .slideshow {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 0;
  }

  .layer {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 1s ease; /* crossfade duration */
    background: #000;
  }

  .layer.visible { opacity: 1; }

  /* Image should cover the entire screen while preserving aspect ratio */
  .layer img {
    max-width: none;
    width: 100vw;
    height: 100vh;
    object-fit: contain; /* use cover if you want to crop instead */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
  }

  /* Start overlay */
  .overlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.9);
    color: #fff;
    cursor: pointer;
    user-select: none;
    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    font-size: 22px;
    letter-spacing: 0.5px;
    text-align: center;
    padding: 24px;
    z-index: 2;
  }
  .overlay.hidden { display: none; }
  .overlay .hint { opacity: 0.7; font-size: 16px; margin-top: 8px; }

  /* Small preload progress */
  .progress { margin-top: 10px; font-size: 14px; opacity: 0.8; }

  /* Glitch overlay (non-interactive, above slideshow) */
  .glitch {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    max-width: 100%;
    display: block;
    overflow: hidden;
    z-index: 1;
    pointer-events: none;
  }
  .glitch__item {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: contain;
    opacity: 0; /* base hidden; animated ones toggle */
    mix-blend-mode: var(--blend-mode-1);
    will-change: transform, clip-path, opacity;
  }
  .glitch__item:nth-child(1) {
    opacity: 0; /* base layer not shown; effects come from animated layers */
  }
  .glitch__item:nth-child(2) {
    background-color: var(--blend-color-2);
    mix-blend-mode: var(--blend-mode-2);
    animation: glitch-anim-2 var(--time-anim) var(--delay-anim) linear infinite;
  }
  .glitch__item:nth-child(3) {
    background-color: var(--blend-color-3);
    mix-blend-mode: var(--blend-mode-3);
    animation: glitch-anim-3 var(--time-anim) var(--delay-anim) linear infinite;
  }
  .glitch__item:nth-child(4) {
    background-color: var(--blend-color-4);
    mix-blend-mode: var(--blend-mode-4);
    animation: glitch-anim-4 var(--time-anim) var(--delay-anim) linear infinite;
  }
  .glitch__item:nth-child(5) {
    background-color: var(--blend-color-5);
    mix-blend-mode: var(--blend-mode-5);
    animation: glitch-anim-flash var(--time-anim) var(--delay-anim) linear infinite;
  }

  @keyframes glitch-anim-flash{
    0%,5%{
      opacity: 0.2;
      transform: translate3d(var(--gap-horizontal),var(--glitch-height),0)
    }
    5.5%,100%{
      opacity: 0;
      transform: translate3d(0, 0, 0);
    }
  }

  @keyframes glitch-anim-2{
    0% { opacity: 1; transform: translate3d(var(--gap-horizontal),0,0); clip-path: polygon(0 2%, 100% 2%, 100% 5%, 0 5%); }
    2% { clip-path: polygon(0 15%, 100% 15%, 100% 15%, 0 15%); }
    4% { clip-path: polygon(0 10%, 100% 10%, 100% 20%, 0 20%); }
    6% { clip-path: polygon(0 1%, 100% 1%, 100% 2%, 0 2%); }
    8% { clip-path: polygon(0 33%, 100% 33%, 100% 33%, 0 33%); }
    10% { clip-path: polygon(0 44%, 100% 44%, 100% 44%, 0 44%); }
    12% { clip-path: polygon(0 50%, 100% 50%, 100% 20%, 0 20%); }
    14% { clip-path: polygon(0 70%, 100% 70%, 100% 70%, 0 70%); }
    16% { clip-path: polygon(0 80%, 100% 80%, 100% 80%, 0 80%); }
    18% { clip-path: polygon(0 50%, 100% 50%, 100% 55%, 0 55%); }
    20% { clip-path: polygon(0 70%, 100% 70%, 100% 80%, 0 80%); }
    21.9% { opacity: 1; transform: translate3d(var(--gap-horizontal),0,0); }
    22%, 100% { opacity: 0; transform: translate3d(0,0,0); clip-path: polygon(0 0, 0 0, 0 0, 0 0); }
  }

  @keyframes glitch-anim-3{
    0% { opacity: 1; transform: translate3d(calc(-1 * var(--gap-horizontal)),0,0); clip-path: polygon(0 25%, 100% 25%, 100% 30%, 0 30%); }
    3% { clip-path: polygon(0 3%, 100% 3%, 100% 3%, 0 3%); }
    5% { clip-path: polygon(0 5%, 100% 5%, 100% 20%, 0 20%); }
    7% { clip-path: polygon(0 20%, 100% 20%, 100% 20%, 0 20%); }
    9% { clip-path: polygon(0 40%, 100% 40%, 100% 40%, 0 40%); }
    11% { clip-path: polygon(0 52%, 100% 52%, 100% 59%, 0 59%); }
    13% { clip-path: polygon(0 60%, 100% 60%, 100% 60%, 0 60%); }
    15% { clip-path: polygon(0 75%, 100% 75%, 100% 75%, 0 75%); }
    17% { clip-path: polygon(0 65%, 100% 65%, 100% 40%, 0 40%); }
    19% { clip-path: polygon(0 45%, 100% 45%, 100% 50%, 0 50%); }
    20% { clip-path: polygon(0 14%, 100% 14%, 100% 33%, 0 33%); }
    21.9% { opacity: 1; transform: translate3d(calc(-1 * var(--gap-horizontal)),0,0); }
    22%, 100% { opacity: 0; transform: translate3d(0,0,0); clip-path: polygon(0 0, 0 0, 0 0, 0 0); }
  }

  @keyframes glitch-anim-4{
    0% { opacity: 1; transform: translate3d(0, calc(-1 * var(--gap-vertical)), 0) scale3d(-1,-1,1); clip-path: polygon(0 1%, 100% 1%, 100% 3%, 0 3%); }
    1.5% { clip-path: polygon(0 10%, 100% 10%, 100% 9%, 0 9%); }
    2% { clip-path: polygon(0 5%, 100% 5%, 100% 6%, 0 6%); }
    2.5% { clip-path: polygon(0 20%, 100% 20%, 100% 20%, 0 20%); }
    3% { clip-path: polygon(0 10%, 100% 10%, 100% 10%, 0 10%); }
    5% { clip-path: polygon(0 30%, 100% 30%, 100% 25%, 0 25%); }
    5.5% { clip-path: polygon(0 15%, 100% 15%, 100% 16%, 0 16%); }
    7% { clip-path: polygon(0 40%, 100% 40%, 100% 39%, 0 39%); }
    8% { clip-path: polygon(0 20%, 100% 20%, 100% 21%, 0 21%); }
    9% { clip-path: polygon(0 60%, 100% 60%, 100% 55%, 0 55%); }
    10.5% { clip-path: polygon(0 30%, 100% 30%, 100% 31%, 0 31%); }
    11% { clip-path: polygon(0 70%, 100% 70%, 100% 69%, 0 69%); }
    13% { clip-path: polygon(0 40%, 100% 40%, 100% 41%, 0 41%); }
    14% { clip-path: polygon(0 80%, 100% 80%, 100% 75%, 0 75%); }
    14.5% { clip-path: polygon(0 50%, 100% 50%, 100% 51%, 0 51%); }
    15% { clip-path: polygon(0 90%, 100% 90%, 100% 90%, 0 90%); }
    16% { clip-path: polygon(0 60%, 100% 60%, 100% 60%, 0 60%); }
    18% { clip-path: polygon(0 100%, 100% 100%, 100% 99%, 0 99%); }
    20% { clip-path: polygon(0 70%, 100% 70%, 100% 71%, 0 71%); }
    21.9% { opacity: 1; transform: translate3d(0, calc(-1 * var(--gap-vertical)), 0) scale3d(-1,-1,1); }
    22%, 100% { opacity: 0; transform: translate3d(0,0,0); clip-path: polygon(0 0, 0 0, 0 0, 0 0); }
  }
</style>
</head>
<body>
  <div class="slideshow" aria-live="off" aria-hidden="true">
    <div class="layer" id="layerA"><img alt="" /></div>
    <div class="layer" id="layerB"><img alt="" /></div>
  </div>

  <!-- Glitch overlay on top of slideshow -->
  <div class="glitch" aria-hidden="true">
    <img class="glitch__item" alt="" />
    <img class="glitch__item" alt="" />
    <img class="glitch__item" alt="" />
    <img class="glitch__item" alt="" />
    <img class="glitch__item" alt="" />
  </div>

  <div class="overlay" id="overlay">
    <div>
      <div>klik om te beginnen</div>
      <div class="progress" id="progress">r/preso/2025</div>
    </div>
  </div>

<script>
(function() {
  const IMAGE_FILES = [
    '/img/01.gif',
    '/img/02.gif','/img/03.gif','/img/04.gif','/img/05.gif','/img/06.gif',
    '/img/07.gif','/img/09.gif','/img/10.gif','/img/11.gif','/img/12b.gif'
  ];

  const DISPLAY_MS = 10000; // 10 seconds each
  const FADE_MS = 1000;     // 1 second crossfade

  const overlay = document.getElementById('overlay');
  const progress = document.getElementById('progress');
  const layerA = document.getElementById('layerA');
  const layerB = document.getElementById('layerB');
  const imgA = layerA.querySelector('img');
  const imgB = layerB.querySelector('img');
  const glitchItems = Array.from(document.querySelectorAll('.glitch__item'));

  let preloaded = [];
  let order = [];
  let index = 0;
  let activeIsA = true;
  let timer = null;

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function preloadImages(paths, onProgress) {
    return Promise.all(paths.map((src, i) => new Promise(resolve => {
      const img = new Image();
      img.onload = () => { onProgress(i + 1, paths.length); resolve({ src, img }); };
      img.onerror = () => { onProgress(i + 1, paths.length); resolve({ src, img }); };
      img.src = src;
    })));
  }

  function setImage(el, src) {
    el.setAttribute('src', src);
  }

  function updateGlitchImages(src) {
    for (const gi of glitchItems) {
      gi.src = src;
      gi.style.opacity = 1; // enable overlay visibility
    }
  }

  function getNextSrc() {
    const src = order[index % order.length];
    index += 1;
    if (index % order.length === 0) {
      order = shuffle(order.slice());
    }
    return src;
  }

  function crossfadeTo(src) {
    if (activeIsA) {
      setImage(imgB, src);
      requestAnimationFrame(() => {
        layerB.classList.add('visible');
        setTimeout(() => layerA.classList.remove('visible'), FADE_MS);
        activeIsA = false;
      });
    } else {
      setImage(imgA, src);
      requestAnimationFrame(() => {
        layerA.classList.add('visible');
        setTimeout(() => layerB.classList.remove('visible'), FADE_MS);
        activeIsA = true;
      });
    }
    updateGlitchImages(src);
  }

  async function start() {
    // Initialize order
    order = shuffle(IMAGE_FILES.slice());

    // Preload first
    progress.textContent = 'Preloading 0/' + IMAGE_FILES.length + '…';
    preloaded = await preloadImages(IMAGE_FILES, (done, total) => {
      progress.textContent = `Preloading ${done}/${total}…`;
    });
    progress.textContent = 'Ready';

    // First image visible immediately
    const first = getNextSrc();
    setImage(imgA, first);
    layerA.classList.add('visible');
    activeIsA = true;
    updateGlitchImages(first);

    // Hide overlay and go fullscreen
    await requestFullscreenSafe();
    overlay.classList.add('hidden');

    // Start loop
    scheduleNext();
  }

  function scheduleNext() {
    if (timer) clearTimeout(timer);
    timer = setTimeout(() => {
      const next = getNextSrc();
      crossfadeTo(next);
      scheduleNext();
    }, DISPLAY_MS);
  }

  async function requestFullscreenSafe() {
    const el = document.documentElement;
    try {
      if (el.requestFullscreen) { await el.requestFullscreen(); }
      else if (el.webkitRequestFullscreen) { await el.webkitRequestFullscreen(); }
      else if (el.msRequestFullscreen) { await el.msRequestFullscreen(); }
    } catch (_) {}
  }

  // Start on click/tap
  overlay.addEventListener('click', start, { once: true });
  overlay.addEventListener('touchstart', start, { once: true });

  // Allow ESC to exit fullscreen; keep slideshow running regardless
  document.addEventListener('fullscreenchange', () => {
    // no-op; could show a hint if exited
  });
})();
</script>
</body>
</html>
